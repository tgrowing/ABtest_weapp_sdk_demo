/*! For license information please see tabc_sdk.wx.js.LICENSE */
module.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=8)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TAB_SDK_EVENT_ERROR_INFO=t.TAB_SDK_EVENT_GET_EXP_BYNAME=t.TAB_SDK_EVENT_RELOAD=t.TAB_SDK_EVENT_SWITCH_USER=t.TAB_SDK_EVENT_SYNCREMOTE=t.TAB_SDK_EVENT_INITLOCAL=t.TAB_SDK_EVENT_RATE=t.TAB_PROFILE_KEY_SDKVER=t.TAB_PROFILE_KEY_OSMODEL=t.TAB_PROFILE_KEY_PLATFORM_VER=t.TAB_PROFILE_KEY_MODEL=t.TAB_PROFILE_KEY_PBRAND=t.TAB_PROFILE_KEY_RESO=t.TAB_PROFILE_KEY_PLATFORM=t.MaxReportParamLen=t.DefaultUpdateTime=t.UserId=t.HitExpMap=t.SDKStrategy=t.ExpData=t.UserIdLocal=t.TABCBeaconAppKey=t.DefaultAssignment=t.DefaultLayerCode=t.DefaultGrayId=t.DefaultHttpTimeout=t.getReportConfig=t.reportUrl=t.baseUrl=t.testBaseUrl=void 0,t.testBaseUrl="http://abtest-private.fsphere.cn:32215",t.baseUrl="http://abtest-private.fsphere.cn:32215",t.reportUrl="http://154.8.202.237:31001/common/kv",t.getReportConfig=e=>e?{experimentUrl:"https://test.abtest.qq.com/tabc/get_gray_policy",reportUrl:"https://dtreport.testsite.woa.com/common/kv",dataLinkId:"KU421GP92NDH4GFF"}:{experimentUrl:"https://abtest.qq.com/tabc/get_gray_policy",reportUrl:"https://report.growth.qq.com/common/kv",dataLinkId:"1078082"},t.DefaultHttpTimeout=2e3,t.DefaultGrayId=1,t.DefaultLayerCode="default",t.DefaultAssignment="default",t.TABCBeaconAppKey="JS04DCPU3VBYY7",t.UserIdLocal="_noqb_guid",t.ExpData="experimentInfo",t.SDKStrategy="strategy",t.HitExpMap="expHitMap",t.UserId="userId",t.DefaultUpdateTime=6e4,t.MaxReportParamLen=1e3,t.TAB_PROFILE_KEY_PLATFORM="ROMA_PLATFORM",t.TAB_PROFILE_KEY_RESO="ROMA_RESOLUTION",t.TAB_PROFILE_KEY_PBRAND="ROMA_DEV_BRAND",t.TAB_PROFILE_KEY_MODEL="ROMA_DEV_MODEL",t.TAB_PROFILE_KEY_PLATFORM_VER="ROMA_PLATFORM_VER",t.TAB_PROFILE_KEY_OSMODEL="ROMA_OS_MODEL",t.TAB_PROFILE_KEY_SDKVER="ROMA_SDK_VERSION",t.TAB_SDK_EVENT_RATE=1,t.TAB_SDK_EVENT_INITLOCAL="initLocal",t.TAB_SDK_EVENT_SYNCREMOTE="syncRemote",t.TAB_SDK_EVENT_SWITCH_USER="switchUser",t.TAB_SDK_EVENT_RELOAD="reload",t.TAB_SDK_EVENT_GET_EXP_BYNAME="getExpByName",t.TAB_SDK_EVENT_ERROR_INFO="ERROR_INFO"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultLogger=t.Logger=void 0;class n{constructor(){this.method=console.log,this.level=2}setMethod(e){this.method=e}setLevel(e){this.level=e}debug(e){this.level<=0&&this.method(e)}info(e){this.level<=1&&this.method(e)}error(e,t){this.level<=2&&(this.method(e),t&&this.method(t))}}t.Logger=n;const o=new n;t.DefaultLogger=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(5);n.__exportStar(r(1),t),n.__exportStar(r(6),t),n.__exportStar(r(0),t),n.__exportStar(r(9),t),n.__exportStar(r(10),t),n.__exportStar(r(11),t),n.__exportStar(r(12),t),n.__exportStar(r(13),t),n.__exportStar(r(18),t),n.__exportStar(r(19),t),n.__exportStar(r(3),t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.postReq=t.getCurrentPageUrl=t.generateExpIds=t.createGuid=t.encodeParams2=t.encodeParams=t.DefaultExp=void 0;const n=r(0);t.DefaultExp=function(e,t,r){return{expName:t,assignment:n.DefaultAssignment,grayId:e||n.DefaultGrayId,layerCode:r||n.DefaultLayerCode,params:new Map}},t.encodeParams=function(e){let t="";return Object.keys(e).forEach(r=>{""!==t&&(t+="&"),t+=`${r}=${e[r]}`}),t},t.encodeParams2=function(e){let t="";return Object.keys(e).forEach(r=>{""!==t&&(t+="|"),t+=`${r}=${e[r]}`}),t},t.createGuid=function(){return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},t.generateExpIds=function(e){if(e){let t="";return e.forEach((e,r)=>{t+=e.grayId+"#"}),t}return""},t.getCurrentPageUrl=function(){return window?window.location.href:""};const o=(e,t,r,n={"Content-Type":"application/x-www-form-urlencoded"},o=!1)=>new Promise((i,a)=>{const s=new XMLHttpRequest;let c;s.timeout=5e3,s.withCredentials=!!o,s.open(t,e),r&&"application/x-www-form-urlencoded"===n["Content-Type"]?c=(e=>{let t="";for(const r of Object.keys(e)){""!==t&&(t+="&");t+=`${r}=${encodeURIComponent(e[r])}`}return t})(r):r&&"application/json;charset=UTF-8"===n["Content-Type"]&&(c=JSON.stringify(r)),n&&Object.keys(n).map(e=>{s.setRequestHeader(e,n[e])}),s.onload=function(){if(200===s.status)i(s.responseText);else{const e={message:-1};e.message=s.status,a(Error(e))}},"POST"===t&&c?s.send(c):s.send()});t.postReq=(e,t)=>o(e,"POST",t,{"Content-Type":"application/json;charset=UTF-8"}).then(e=>e)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getCache=t.setCache=t.getSystemInfo=t.postReq=void 0;const n=wx||qq;t.postReq=function(e,t,r){return new Promise((o,i)=>{const a={url:e,data:t,header:{"Content-Type":"application/json;charset=UTF-8"},method:"POST",success(e){200===e.statusCode?o(JSON.stringify(e.data)):i(Error("error http code"))},fail(){i(Error("error load net data"))}};r&&r>0&&(a.timeout=r),n.request(a)})},t.getSystemInfo=function(){const e=new Map,t=n.getSystemInfoSync();return e.set("resolution",`${t.screenWidth}*${t.screenHeight}`),e.set("brand",t.brand),e.set("model",t.model),e.set("version",t.version),e.set("SDKVersion",t.SDKVersion),e.set("system",t.system),e},t.setCache=function(e,t){return new Promise(r=>{n.setStorage({key:e,data:t}),r()})},t.getCache=function(e){return new Promise(t=>{n.getStorage({key:e,success(e){t(e.data)},fail(){t(null)}})})}},function(e,t,r){"use strict";r.r(t),r.d(t,"__extends",(function(){return o})),r.d(t,"__assign",(function(){return i})),r.d(t,"__rest",(function(){return a})),r.d(t,"__decorate",(function(){return s})),r.d(t,"__param",(function(){return c})),r.d(t,"__metadata",(function(){return u})),r.d(t,"__awaiter",(function(){return l})),r.d(t,"__generator",(function(){return p})),r.d(t,"__createBinding",(function(){return f})),r.d(t,"__exportStar",(function(){return d})),r.d(t,"__values",(function(){return h})),r.d(t,"__read",(function(){return m})),r.d(t,"__spread",(function(){return y})),r.d(t,"__spreadArrays",(function(){return g})),r.d(t,"__spreadArray",(function(){return E})),r.d(t,"__await",(function(){return _})),r.d(t,"__asyncGenerator",(function(){return v})),r.d(t,"__asyncDelegator",(function(){return b})),r.d(t,"__asyncValues",(function(){return S})),r.d(t,"__makeTemplateObject",(function(){return x})),r.d(t,"__importStar",(function(){return D})),r.d(t,"__importDefault",(function(){return O})),r.d(t,"__classPrivateFieldGet",(function(){return w})),r.d(t,"__classPrivateFieldSet",(function(){return R}));var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)};function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var i=function(){return(i=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function a(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(r[n[o]]=e[n[o]])}return r}function s(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a}function c(e,t){return function(r,n){t(r,n,e)}}function u(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function l(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))}function p(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}var f=Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]};function d(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||f(t,e,r)}function h(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function m(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a}function y(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(m(arguments[t]));return e}function g(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var i=arguments[t],a=0,s=i.length;a<s;a++,o++)n[o]=i[a];return n}function E(e,t,r){if(r||2===arguments.length)for(var n,o=0,i=t.length;o<i;o++)!n&&o in t||(n||(n=Array.prototype.slice.call(t,0,o)),n[o]=t[o]);return e.concat(n||Array.prototype.slice.call(t))}function _(e){return this instanceof _?(this.v=e,this):new _(e)}function v(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,o=r.apply(e,t||[]),i=[];return n={},a("next"),a("throw"),a("return"),n[Symbol.asyncIterator]=function(){return this},n;function a(e){o[e]&&(n[e]=function(t){return new Promise((function(r,n){i.push([e,t,r,n])>1||s(e,t)}))})}function s(e,t){try{(r=o[e](t)).value instanceof _?Promise.resolve(r.value.v).then(c,u):l(i[0][2],r)}catch(e){l(i[0][3],e)}var r}function c(e){s("next",e)}function u(e){s("throw",e)}function l(e,t){e(t),i.shift(),i.length&&s(i[0][0],i[0][1])}}function b(e){var t,r;return t={},n("next"),n("throw",(function(e){throw e})),n("return"),t[Symbol.iterator]=function(){return this},t;function n(n,o){t[n]=e[n]?function(t){return(r=!r)?{value:_(e[n](t)),done:"return"===n}:o?o(t):t}:o}}function S(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=h(e),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise((function(n,o){(function(e,t,r,n){Promise.resolve(n).then((function(t){e({value:t,done:r})}),t)})(n,o,(t=e[r](t)).done,t.value)}))}}}function x(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var T=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t};function D(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&f(t,e,r);return T(t,e),t}function O(e){return e&&e.__esModule?e:{default:e}}function w(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)}function R(e,t,r,n,o){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?o.call(e,r):o?o.value=r:t.set(e,r),r}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SDKEventHandler=void 0;t.SDKEventHandler=class{constructor(){this.eventListerners=new Map,this.eventListerners.set(0,[]),this.eventListerners.set(1,[]),this.eventListerners.set(2,[]),this.eventListerners.set(3,[]),this.eventListerners.set(4,[])}registEventListener(e,t){if(!t)return!1;const r=this.eventListerners.get(e);return!!r&&(r.push(t),!0)}onEvent(e){const t=this.eventListerners.get(e);t&&t.length>0&&t.forEach(e=>{e()})}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TabCWxSDK=void 0;const n=r(2),o=r(21),i=r(22),a=r(4),s=r(23);class c extends n.TabCSDK{constructor(e){super(e,"0.1.5")}initLoaderAndReporters(){const e=this.memStore.userConfig;this.lLoader=new o.WxLocalLoder(`${e.appkey}_${this.memStore.name}`),this.rLoader=new i.WxRemoteLoader(this.memStore),this.reporter=new s.TabWeixinBeaconReporter(this.memStore)}initProfiles(){const e=this.memStore.userConfig,t=e.profiles||{};t[n.TAB_PROFILE_KEY_PLATFORM]="miniprogram";const r=this.memStore.systemInfo;t[n.TAB_PROFILE_KEY_RESO]=r.get("resolution")||"",t[n.TAB_PROFILE_KEY_PBRAND]=r.get("brand")||"",t[n.TAB_PROFILE_KEY_MODEL]=r.get("model")||"",t.ROMA_WEIXIN_VER=r.get("version")||"",t[n.TAB_PROFILE_KEY_PLATFORM_VER]=r.get("SDKVersion")||"",t[n.TAB_PROFILE_KEY_OSMODEL]=r.get("system")||"",t[n.TAB_PROFILE_KEY_SDKVER]=this.memStore.version,e.profiles=t}initSystemInfo(){return a.getSystemInfo()}setBeaconSDK(e){this.memStore.beaconSDK=e}}t.TabCWxSDK=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setLogMethod=t.setLogLevel=t.reportExpEvent=t.reportExpExpose=t.getCachedExpByName=t.getExpByNameAndReport=t.getExpByName=t.getAllExps=t.forceReload=t.switchUser=t.clear=t.setBeaconSDK=t.init=t.getInstance=t.tabc=void 0;const n=r(5),o=r(2),i=r(7);n.__exportStar(r(7),t);const a=o.DefaultLogger;t.tabc=new i.TabCWxSDK;const s=new Map;s.set("default",t.tabc),t.getInstance=function(e){let t=s.get(e);return t||(t=new i.TabCWxSDK(e),s.set(e,t)),t},t.init=function(e){return t.tabc.init(e)},t.setBeaconSDK=function(e){return t.tabc.setBeaconSDK(e)},t.clear=function(){t.tabc.clear()},t.switchUser=function(e,r,n){return new Promise(o=>{t.tabc.switchUser(e,r).then(()=>{n&&n(!0),o(!0)}).catch(()=>{n&&n(!1),o(!1)})})},t.forceReload=function(){return t.tabc.forceReload()},t.getAllExps=function(){return t.tabc.getAllExps()},t.getExpByName=function(e,r){return new Promise((n,o)=>{t.tabc.getExpByName(e).then(e=>{a.info("getExpByName got exp "+e.grayId),r&&r(e),n(e)}).catch(e=>{a.error(e),o(e)})})},t.getExpByNameAndReport=function(e,r){return new Promise((n,o)=>{t.tabc.getExpByNameAndReport(e).then(e=>{a.info("getExpByNameAndReport got exp "+e.grayId),r&&r(e),n(e)}).catch(e=>{a.error(e),o(e)})})},t.getCachedExpByName=function(e){return t.tabc.getCachedExpByName(e)},t.reportExpExpose=function(e){return t.tabc.reportExpExpose(e)},t.reportExpEvent=function(e,r){return t.tabc.reportExpEvent(e,r)},t.setLogLevel=function(e){a.setLevel(e)},t.setLogMethod=function(e){a.setMethod(e)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LocalLoader=void 0;const n=r(0),o=r(1).DefaultLogger;t.LocalLoader=class{constructor(e="default"){this.identifier=e,this.storedData=new Map,this.defaultLoaders=[],this.defaultLoaders.push(this.loadExpData),this.defaultLoaders.push(this.loadStrategyData),this.defaultLoaders.push(this.loadHitExpMap)}saveUserId(e){return new Promise(t=>{this.save(""+n.UserIdLocal,e),t()})}saveHitExpMap(e){return new Promise((t,r)=>{const o={};e.forEach((e,t)=>{o[t]=e});const i=JSON.stringify(o);this.save(`${this.identifier}_${n.HitExpMap}`,i).then(()=>t()).catch(e=>r(e))})}saveStrategyData(e){return new Promise((t,r)=>{const o=JSON.stringify(e);this.save(`${this.identifier}_${n.SDKStrategy}`,o).then(()=>t()).catch(e=>r(e))})}saveExpData(e){return new Promise((t,r)=>{const o={};e.forEach((e,t)=>{o[t]=e});const i=JSON.stringify(o);this.save(`${this.identifier}_${n.ExpData}`,i).then(()=>t()).catch(e=>r(e))})}loadUserId(){return new Promise((e,t)=>{this.load(""+n.UserIdLocal).then(t=>{if(o.debug(t),!t)return e();this.storedData.set(n.UserId,t),e()}).catch(e=>t(e))})}loadExpData(){return new Promise((e,t)=>{this.load(`${this.identifier}_${n.ExpData}`).then(r=>{if(o.debug(r),r){const o=new Map;this.storedData.set(n.ExpData,o);try{const t=JSON.parse(r);Object.keys(t).forEach(e=>{const r=t[e];o.set(e,r)}),e()}catch(e){t(e)}}else e()}).catch(e=>t(e))})}loadStrategyData(){return new Promise((e,t)=>{this.load(`${this.identifier}_${n.SDKStrategy}`).then(r=>{if(o.debug(r),r)try{const t=JSON.parse(r);this.storedData.set(n.SDKStrategy,t),e()}catch(e){t(e)}else e()}).catch(e=>t(e))})}loadHitExpMap(){return new Promise((e,t)=>{this.load(`${this.identifier}_${n.HitExpMap}`).then(r=>{if(o.debug(r),r){const o=new Map;this.storedData.set(n.HitExpMap,o);try{const t=JSON.parse(r);Object.keys(t).forEach(e=>{const r=parseInt(t[e],10);o.set(parseInt(e,10),r)}),e()}catch(e){t(e)}}else e()}).catch(e=>t(e))})}loadAllData(){return new Promise((e,t)=>{o.debug("loadAllData");const r=[];this.defaultLoaders.forEach(e=>{const t=e.call(this);r.push(t)}),Promise.all(r).then(()=>{o.debug("loaddAllData success"),o.debug(this.storedData),e(this.storedData)}).catch(e=>t(e))})}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RemoteLoader=void 0;const n=r(5),o=r(1),i=r(0),a=n.__importStar(r(0)),s=r(14),c=r(3),u=o.DefaultLogger;t.RemoteLoader=class{constructor(e){this.store=e}loadData(e){return new Promise((t,r)=>{const n=this.store.userConfig,o=n.experimentUrl,i={guid:n.guid,appkey:n.appkey,channel:n.channel,profiles:JSON.stringify(n.profiles),url:n.url||c.getCurrentPageUrl()};let s=!1;e&&(i.expName=e,s=!0),n.layerCodes&&(i.layerCodes=n.layerCodes);const l=n.timeout||a.DefaultHttpTimeout;(s?this.reqWithTimeout(o,i,l):this.loadRemoteData(o,i,-1)).then(e=>{u.debug(e);try{const n=JSON.parse(e);if(0===n.code){const e=this.processData(n);t(e)}else r(Error("error http code"))}catch(e){r(e)}}).catch(e=>{r(e)})})}processExpData(e){const t=new Map,r=e.data;return r?(Object.keys(r).forEach(e=>{const n=r[e],o={expName:n.expName,assignment:n.assignment,grayId:n.sGrayPolicyId,layerCode:e,params:n.params,percentage:n.percentage,bucket:n.bucket,isFirstHit:n.isFirstHit,endTime:n.endTime};t.set(e,o)}),t):t}processStrategyData(e){const t=e.strategy;if(!t)return null;const r={refreshDuration:t.refreshDuration,enableReport:t.enableReport,reportType:t.reportType,attaId:t.reportConfig.id,attaToken:t.reportConfig.token,debug:t.debug,sdkReportRate:t.sdkReportRate};t.debug&&(r.debug=!0);const n=t.sdkReportRate;return s.isNumber(n)&&n>=0&&n<=100&&(r.sdkReportRate=n),r}processData(e){const t=new Map;try{const r=this.processExpData(e),n=this.processStrategyData(e);t.set(i.ExpData,r),t.set(i.SDKStrategy,n)}catch(e){throw u.error("process net data failed",e),Error("error process data")}return t}reqWithTimeout(e,t,r){return new Promise((n,o)=>(u.debug("reqWithTimeout"),Promise.race([this.loadRemoteData(e,t,r),new Promise(e=>{setTimeout(()=>e(new Error("request timeout")),r)})]).then(e=>n(e)).catch(e=>o(e))))}}},function(e,t,r){(function(e){var n=Object.getOwnPropertyDescriptors||function(e){for(var t=Object.keys(e),r={},n=0;n<t.length;n++)r[t[n]]=Object.getOwnPropertyDescriptor(e,t[n]);return r},o=/%[sdj%]/g;t.format=function(e){if(!g(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(s(arguments[r]));return t.join(" ")}r=1;for(var n=arguments,i=n.length,a=String(e).replace(o,(function(e){if("%%"===e)return"%";if(r>=i)return e;switch(e){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(e){return"[Circular]"}default:return e}})),c=n[r];r<i;c=n[++r])m(c)||!v(c)?a+=" "+c:a+=" "+s(c);return a},t.deprecate=function(r,n){if(void 0!==e&&!0===e.noDeprecation)return r;if(void 0===e)return function(){return t.deprecate(r,n).apply(this,arguments)};var o=!1;return function(){if(!o){if(e.throwDeprecation)throw new Error(n);e.traceDeprecation,o=!0}return r.apply(this,arguments)}};var i,a={};function s(e,r){var n={seen:[],stylize:u};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),h(r)?n.showHidden=r:r&&t._extend(n,r),E(n.showHidden)&&(n.showHidden=!1),E(n.depth)&&(n.depth=2),E(n.colors)&&(n.colors=!1),E(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=c),l(n,e,n.depth)}function c(e,t){var r=s.styles[t];return r?"["+s.colors[r][0]+"m"+e+"["+s.colors[r][1]+"m":e}function u(e,t){return e}function l(e,r,n){if(e.customInspect&&r&&x(r.inspect)&&r.inspect!==t.inspect&&(!r.constructor||r.constructor.prototype!==r)){var o=r.inspect(n,e);return g(o)||(o=l(e,o,n)),o}var i=function(e,t){if(E(t))return e.stylize("undefined","undefined");if(g(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}if(y(t))return e.stylize(""+t,"number");if(h(t))return e.stylize(""+t,"boolean");if(m(t))return e.stylize("null","null")}(e,r);if(i)return i;var a=Object.keys(r),s=function(e){var t={};return e.forEach((function(e,r){t[e]=!0})),t}(a);if(e.showHidden&&(a=Object.getOwnPropertyNames(r)),S(r)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return p(r);if(0===a.length){if(x(r)){var c=r.name?": "+r.name:"";return e.stylize("[Function"+c+"]","special")}if(_(r))return e.stylize(RegExp.prototype.toString.call(r),"regexp");if(b(r))return e.stylize(Date.prototype.toString.call(r),"date");if(S(r))return p(r)}var u,v="",T=!1,O=["{","}"];(d(r)&&(T=!0,O=["[","]"]),x(r))&&(v=" [Function"+(r.name?": "+r.name:"")+"]");return _(r)&&(v=" "+RegExp.prototype.toString.call(r)),b(r)&&(v=" "+Date.prototype.toUTCString.call(r)),S(r)&&(v=" "+p(r)),0!==a.length||T&&0!=r.length?n<0?_(r)?e.stylize(RegExp.prototype.toString.call(r),"regexp"):e.stylize("[Object]","special"):(e.seen.push(r),u=T?function(e,t,r,n,o){for(var i=[],a=0,s=t.length;a<s;++a)D(t,String(a))?i.push(f(e,t,r,n,String(a),!0)):i.push("");return o.forEach((function(o){o.match(/^\d+$/)||i.push(f(e,t,r,n,o,!0))})),i}(e,r,n,s,a):a.map((function(t){return f(e,r,n,s,t,T)})),e.seen.pop(),function(e,t,r){if(e.reduce((function(e,t){return t.indexOf("\n")>=0&&0,e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60)return r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1];return r[0]+t+" "+e.join(", ")+" "+r[1]}(u,v,O)):O[0]+v+O[1]}function p(e){return"["+Error.prototype.toString.call(e)+"]"}function f(e,t,r,n,o,i){var a,s,c;if((c=Object.getOwnPropertyDescriptor(t,o)||{value:t[o]}).get?s=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(s=e.stylize("[Setter]","special")),D(n,o)||(a="["+o+"]"),s||(e.seen.indexOf(c.value)<0?(s=m(r)?l(e,c.value,null):l(e,c.value,r-1)).indexOf("\n")>-1&&(s=i?s.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+s.split("\n").map((function(e){return"   "+e})).join("\n")):s=e.stylize("[Circular]","special")),E(a)){if(i&&o.match(/^\d+$/))return s;(a=JSON.stringify(""+o)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=e.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=e.stylize(a,"string"))}return a+": "+s}function d(e){return Array.isArray(e)}function h(e){return"boolean"==typeof e}function m(e){return null===e}function y(e){return"number"==typeof e}function g(e){return"string"==typeof e}function E(e){return void 0===e}function _(e){return v(e)&&"[object RegExp]"===T(e)}function v(e){return"object"==typeof e&&null!==e}function b(e){return v(e)&&"[object Date]"===T(e)}function S(e){return v(e)&&("[object Error]"===T(e)||e instanceof Error)}function x(e){return"function"==typeof e}function T(e){return Object.prototype.toString.call(e)}t.debuglog=function(r){if(E(i)&&(i=e.env.NODE_DEBUG||""),r=r.toUpperCase(),!a[r])if(new RegExp("\\b"+r+"\\b","i").test(i)){e.pid;a[r]=function(){t.format.apply(t,arguments)}}else a[r]=function(){};return a[r]},t.inspect=s,s.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},s.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=d,t.isBoolean=h,t.isNull=m,t.isNullOrUndefined=function(e){return null==e},t.isNumber=y,t.isString=g,t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=E,t.isRegExp=_,t.isObject=v,t.isDate=b,t.isError=S,t.isFunction=x,t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=r(16);function D(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.log=function(){},t.inherits=r(17),t._extend=function(e,t){if(!t||!v(t))return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e};var O="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function w(e,t){if(!e){var r=new Error("Promise was rejected with a falsy value");r.reason=e,e=r}return t(e)}t.promisify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');if(O&&e[O]){var t;if("function"!=typeof(t=e[O]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(t,O,{value:t,enumerable:!1,writable:!1,configurable:!0}),t}function t(){for(var t,r,n=new Promise((function(e,n){t=e,r=n})),o=[],i=0;i<arguments.length;i++)o.push(arguments[i]);o.push((function(e,n){e?r(e):t(n)}));try{e.apply(this,o)}catch(e){r(e)}return n}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),O&&Object.defineProperty(t,O,{value:t,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(t,n(e))},t.promisify.custom=O,t.callbackify=function(t){if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');function r(){for(var r=[],n=0;n<arguments.length;n++)r.push(arguments[n]);var o=r.pop();if("function"!=typeof o)throw new TypeError("The last argument must be of type Function");var i=this,a=function(){return o.apply(i,arguments)};t.apply(this,r).then((function(t){e.nextTick(a,null,t)}),(function(t){e.nextTick(w,t,a)}))}return Object.setPrototypeOf(r,Object.getPrototypeOf(t)),Object.defineProperties(r,n(t)),r}}).call(this,r(15))},function(e,t){var r,n,o=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(r===setTimeout)return setTimeout(e,0);if((r===i||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:i}catch(e){r=i}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(e){n=a}}();var c,u=[],l=!1,p=-1;function f(){l&&c&&(l=!1,c.length?u=c.concat(u):p=-1,u.length&&d())}function d(){if(!l){var e=s(f);l=!0;for(var t=u.length;t;){for(c=u,u=[];++p<t;)c&&c[p].run();p=-1,t=u.length}c=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function m(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new h(e,t)),1!==u.length||l||s(d)},h.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=m,o.addListener=m,o.once=m,o.off=m,o.removeListener=m,o.removeAllListeners=m,o.emit=m,o.prependListener=m,o.prependOnceListener=m,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(e,t){e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TabReporter=void 0;const n=r(0),o=r(3),i=r(1).DefaultLogger;t.TabReporter=class{constructor(e){this.memStore=e}reportEvent(e,t){const r=[o.encodeParams2(t)],n=this.memStore.userConfig;let i=n.dataLinkId;const a=this.memStore.strategy;i=(null==a?void 0:a.attaId)||i;const s={dataLinkId:i,datas:r},c=n.reportUrl;return o.postReq(c,s)}reportExpExpose(e){return this.reportExpEvent("rqd_expimpression",e)}reportExpEvent(e,t){return new Promise((r,a)=>{if(!this.checkNeedReport(t))return r(!1);const s=this.memStore.userConfig,c=this.memStore.systemInfo,u={};u.graygroupid=t.expName||"",u.grayid=String(t.grayId),u.guid=s.guid||"",u.appid=s.appkey||"",u.sdkversion=this.memStore.version,u.isfirsthit=t.isFirstHit?"1":"0",u.platform=c.get("ROMA_PLATFORM")||"mpsdk",u.usertype="0",u.explayer=t.layerCode,u.exppercentage=t.percentage?String(t.percentage):"0",u.expbucket=t.bucket?String(t.bucket):"0",u.expenv=s.isTest?"test":"formal",u.channel=s.channel||"all",u.eventtime=(new Date).getTime(),u.eventpage=encodeURIComponent(s.url),u.eventCode=e;let l=o.encodeParams(t.params);l.length>n.MaxReportParamLen&&(l=l.substring(0,n.MaxReportParamLen)+"...");const p=s.profiles||{};return Object.keys(p).forEach(e=>{u[e]=p[e]}),u.exp_params=l,i.debug(l),this.reportEvent(e,u)})}reportSDKEvent(e,t,r,n){return new Promise((i,a)=>{if(!this.checkSDKReport())return i(!1);const s=this.memStore.userConfig,c=this.memStore.systemInfo,u=this.memStore.expData,l={};null==n||n.forEach((e,t)=>{l[t]=e});const p=s.profiles||{};return Object.keys(p).forEach(e=>{l[e]=p[e]}),l.api_name=e,l.consumed_time=r,l.success_flag=t,l.gray_ids=o.generateExpIds(u),l.appid=s.appkey||"",l.guid=s.guid||"",l.sdkversion=this.memStore.version,l.platform=c.get("ROMA_PLATFORM")||"",l.expenv=s.isTest?"test":"formal",this.reportEvent(e,l)})}checkNeedReport(e){return!e.expName||e.assignment!==n.DefaultAssignment}checkSDKReport(){const e=this.memStore.strategy;if(null==e?void 0:e.debug)return!0;const t=(null==e?void 0:e.sdkReportRate)||n.TAB_SDK_EVENT_RATE,r=Math.ceil(100*Math.random());return i.debug(`report api event with random ${r} ${t}`),r<=t}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TabCSDK=void 0;const n=r(1),o=r(0),i=r(3),a=r(6),s=r(20),c=n.DefaultLogger;t.TabCSDK=class{constructor(e="default",t="default"){this.eventHandler=new a.SDKEventHandler,this.memStore={name:e,version:t,isInit:!1,syncFinish:!1,hitExpMap:new Map},this.expHitHandler=new s.ExpHitHandler(this.memStore)}registEventListener(e,t){return this.eventHandler.registEventListener(e,t)}init(e){return new Promise((t,r)=>{if(!e)return c.error("no param config"),this.initFail("no param config"),t(!1);if(this.memStore.isInit)return c.error("already initialized"),this.initFail("already initialized"),t(!1);this.memStore.userConfig=this.initReportConfig(e);if(!this.checkInitParam())return this.initFail("param error"),t(!1);e.isTest&&c.setLevel(0),this.initLoaderAndReporters(),this.expHitHandler.setLocalLoder(this.lLoader);try{const e=this.initSystemInfo();this.memStore.systemInfo=e}catch(e){c.error("error init systemInfo",e)}this.initProfiles(),e.guid||(c.info("guid not set"),this.lLoader.defaultLoaders.push(this.lLoader.loadUserId)),this.doInit().then(()=>{if(this.memStore.expData&&this.initLocalSuccess(),t(!0),this.loadRemoteData().catch(e=>{c.error("error process remote data",e)}),e.onNetData){const t=e.timeout||o.DefaultHttpTimeout;setTimeout(()=>{this.memStore.syncFinish||this.reportErrorEvent(o.TAB_SDK_EVENT_SYNCREMOTE,"timeout"),this.initRemoteSuccess()},t)}e.disableRefresh||(c.info("start refresh timer"),this.initRefreshTimer())}).catch(e=>{this.initFail("init error "+e.message),r(e)})})}setProfiles(e){const t=this.memStore.userConfig;if(!t)return void c.error("please init sdk first");if(!e||"object"!=typeof e)return void c.error("please set profiles uing object");const r=t.profiles||{};Object.keys(e).forEach(t=>{r[t]=e[t]}),t.profiles=r}clear(){this.memStore.isInit=!1,this.memStore.syncFinish=!1,this.memStore.expData=void 0,this.memStore.hitExpMap=new Map,this.memStore.strategy=void 0,this.timeInterval&&clearInterval(this.timeInterval)}switchUser(e,t){return new Promise(r=>{const n=this.memStore.userConfig;if(n.guid===e)return this.reportErrorEvent(o.TAB_SDK_EVENT_SWITCH_USER,"same userid"),r(!1);const i=(new Date).getTime();c.debug("switch to new user "+e),c.debug(t||""),c.debug(n),n.guid=e,t&&(n.profiles=t,this.initProfiles()),this.loadRemoteData().then(()=>{var e;this.eventHandler.onEvent(3),null===(e=this.reporter)||void 0===e||e.reportSDKEvent(o.TAB_SDK_EVENT_SWITCH_USER,!0,(new Date).getTime()-i),r(!0)}).catch(e=>{this.reportErrorEvent(o.TAB_SDK_EVENT_SWITCH_USER,e.message),r(!1)})})}forceReload(){return new Promise(e=>{const t=(new Date).getTime();this.loadRemoteData().then(()=>{var r;this.eventHandler.onEvent(4),null===(r=this.reporter)||void 0===r||r.reportSDKEvent(o.TAB_SDK_EVENT_RELOAD,!0,(new Date).getTime()-t),e(!0)}).catch(t=>{this.reportErrorEvent(o.TAB_SDK_EVENT_RELOAD,t.message),e(!1)})})}getAllExps(){this.expHitHandler.updateIsFirstHit();const e={};return this.memStore.expData&&this.memStore.expData.forEach((t,r)=>{e[r]=t}),e}getAllParams(){const e={};return this.memStore.expData&&this.memStore.expData.forEach(t=>{Object.keys(t.params).forEach(r=>{e[r]=t.params[r]})}),e}getCachedExpByName(e){return this.findExpByName(e)}getExpByName(e){return new Promise(t=>{this.memStore.expData?t(this.findExpByName(e)):this.loadRemoteData(e).then(()=>{t(this.findExpByName(e))}).catch(r=>{c.error(r),t(this.findExpByName(e))})})}findExpByName(e){c.debug("finde exp by name "+e);const t=this.getAllExps();c.debug(t);for(const r of Object.keys(t)){const n=t[r];if(n.expName===e)return n}return i.DefaultExp()}getExpByNameAndReport(e){return new Promise(t=>{this.getExpByName(e).then(e=>{c.info("getExpByNameAndReport get "+e.grayId),t(e),c.info("getExpByNameAndReport report expose for "+e.grayId),this.reportExpExpose(e)})})}reportExpExpose(e){var t;try{null===(t=this.reporter)||void 0===t||t.reportExpExpose(e),this.expHitHandler.setExpHit(e.grayId)}catch(e){c.error(e)}}reportExpEvent(e,t){var r;null===(r=this.reporter)||void 0===r||r.reportExpEvent(e,t)}doInit(){return new Promise((e,t)=>{this.lLoader.loadAllData().then(t=>{var r;this.saveDataToMem(t),(null===(r=this.memStore.strategy)||void 0===r?void 0:r.debug)&&(c.setLevel(0),c.debug("debug is opened")),e(!0)}).catch(e=>{c.error("error init local data",e),t(e)})})}saveDataToMem(e){e.get(o.ExpData)&&(this.memStore.expData=e.get(o.ExpData)),e.get(o.SDKStrategy)&&(this.memStore.strategy=e.get(o.SDKStrategy)),e.get(o.HitExpMap)&&(this.memStore.hitExpMap=e.get(o.HitExpMap));const t=this.memStore.userConfig;t.guid||(c.debug("no guid will load or create one"),e.get(o.UserId)?t.guid=e.get(o.UserId):(t.guid=i.createGuid(),this.lLoader.saveUserId(t.guid))),this.expHitHandler.updateIsFirstHit()}loadRemoteData(e){return new Promise((t,r)=>{const n=(new Date).getTime();this.rLoader.loadData(e).then(e=>{var r;c.debug(e),this.processRometeData(e),this.initRemoteSuccess();const i=(new Date).getTime()-n;null===(r=this.reporter)||void 0===r||r.reportSDKEvent(o.TAB_SDK_EVENT_SYNCREMOTE,!0,i),t()}).catch(e=>{this.reportErrorEvent(o.TAB_SDK_EVENT_SYNCREMOTE,e.message),r(e)})})}processRometeData(e){var t;const r=e.get(o.ExpData),n=e.get(o.SDKStrategy);c.debug(r),c.debug(n),this.memStore.expData=r,this.memStore.strategy=n,this.memStore.refreshDataTime=(new Date).getTime(),this.expHitHandler.updateIsFirstHit(),this.lLoader.saveExpData(r),this.lLoader.saveStrategyData(n),(null===(t=this.memStore.strategy)||void 0===t?void 0:t.debug)&&(c.setLevel(0),c.debug("debug is opened"))}initRefreshTimer(){this.timeInterval=setInterval(()=>{this.loadRemoteDataTimer()},o.DefaultUpdateTime)}loadRemoteDataTimer(){if(!this.memStore.isInit||void 0===this.memStore.strategy)return void c.debug("isInit has not finished and ignore update this time");c.debug("refresh timer check");const e=this.memStore.refreshDataTime;if(e){const t=(new Date).getTime(),r=1e3*this.memStore.strategy.refreshDuration;if(c.debug(`curTime: ${t} -- updateTime: ${e} --\n        diffTime: ${t-e} -- refreshTime: ${r}`),t-e<r)return void c.debug("do not update this time")}this.loadRemoteData()}checkInitParam(){return!!this.memStore.userConfig.appkey||(c.error("appkey not set"),!1)}reportErrorEvent(e,t){var r;const n=new Map;n.set(o.TAB_SDK_EVENT_ERROR_INFO,t),null===(r=this.reporter)||void 0===r||r.reportSDKEvent(e,!1,-1,n)}initReportConfig(e){const t=e,{experimentUrl:r,reportUrl:n,dataLinkId:i}=o.getReportConfig(t.isTest);return t.experimentUrl||(t.experimentUrl=r),t.reportUrl||(t.reportUrl=n),t.dataLinkId||(t.dataLinkId=i),t}initFail(e){this.reportErrorEvent(o.TAB_SDK_EVENT_INITLOCAL,e||"unknown"),this.eventHandler.onEvent(0)}initLocalSuccess(){var e;if(!this.memStore.isInit){this.memStore.isInit=!0;const t=this.memStore.userConfig;t.onInit&&t.onInit(this.getAllParams()),null===(e=this.reporter)||void 0===e||e.reportSDKEvent(o.TAB_SDK_EVENT_INITLOCAL,!0,0),this.eventHandler.onEvent(1)}}initRemoteSuccess(){if(this.initLocalSuccess(),!this.memStore.syncFinish){this.memStore.syncFinish=!0,this.eventHandler.onEvent(2);const e=this.memStore.userConfig;e.onNetData&&e.onNetData(this.getAllParams())}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExpHitHandler=void 0;const n=r(1).DefaultLogger;t.ExpHitHandler=class{constructor(e){this.memStore=e}setLocalLoder(e){this.lLoader=e}setExpHit(e){var t;n.debug("set exp hit "+e);const r=this.memStore.hitExpMap;r.set(e,1),null===(t=this.lLoader)||void 0===t||t.saveHitExpMap(r)}getIsFirstHit(e){return 1!==this.memStore.hitExpMap.get(e)}updateIsFirstHit(){this.memStore.expData&&this.memStore.expData.forEach(e=>{const t=e;this.getIsFirstHit(t.grayId)?t.isFirstHit=!0:t.isFirstHit=!1})}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WxLocalLoder=void 0;const n=r(2),o=r(4),i=n.DefaultLogger;class a extends n.LocalLoader{load(e){return i.debug("get cache "+e),o.getCache(e)}save(e,t){return i.debug(`set cache ${e} ${t}`),o.setCache(e,t)}}t.WxLocalLoder=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WxRemoteLoader=void 0;const n=r(2),o=r(4);class i extends n.RemoteLoader{loadRemoteData(e,t,r){return o.postReq(e,t,r)}}t.WxRemoteLoader=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TabWeixinBeaconReporter=void 0;const n=r(2),o=r(4);class i extends n.TabReporter{isOk(){return!!this.getBeaconSDK()}reportEvent(e,t){const r=[n.encodeParams2(t)],i=this.memStore.userConfig,a=this.memStore.strategy;let s=i.dataLinkId;s=(null==a?void 0:a.attaId)||s;const c={dataLinkId:s,datas:r},u=i.reportUrl;return o.postReq(u,c,5e3)}getBeaconSDK(){return this.memStore.beaconSDK}}t.TabWeixinBeaconReporter=i}]);
//# sourceMappingURL=tabc_sdk.wx.js.map